{"version":3,"sources":["../../src/PrintProvider.jsx"],"names":["React","ReactDOM","PropTypes","spliced","debug","propTypes","loose","bool","children","node","isRequired","invert","childContextTypes","printProvider","shape","regPrintable","func","unregPrintable","isPrint","PrintProvider","props","state","isInPrintPreview","printableNodes","hasSingle","printableRegistry","window","matchMedia","onchange","matches","setState","bind","key","isSingle","undefined","setTimeout","concat","length","Object","assign","el","document","createElement","id","body","appendChild","render","s","printRender","getElementById","removeChild","Children","map","child","cloneElement","createRender","deleteRender","loose_","invert_","hiddenAll_","hiddenAll","wrap","PureComponent"],"mappings":"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","file":"PrintProvider.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport s from './PrintProvider.css';\nimport { spliced, debug } from './common';\n\nexport const propTypes = {\n  loose: PropTypes.bool,\n  children: PropTypes.node.isRequired,\n  invert: PropTypes.bool,\n};\n\nexport const childContextTypes = {\n  printProvider: PropTypes.shape({\n    regPrintable: PropTypes.func.isRequired,\n    unregPrintable: PropTypes.func.isRequired,\n    isPrint: PropTypes.bool.isRequired,\n  }).isRequired,\n};\n\nexport default class PrintProvider extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isInPrintPreview: false,\n      printableNodes: [],\n      hasSingle: false,\n    };\n    this.printableRegistry = {};\n    window.matchMedia('print').onchange = () => {\n      debug('toggle print mode', window.matchMedia('print').matches);\n      this.setState({ isInPrintPreview: window.matchMedia('print').matches });\n    };\n  }\n\n  getChildContext() {\n    return {\n      printProvider: {\n        isPrint: window.matchMedia('print').matches,\n        regPrintable: this.regPrintable.bind(this),\n        unregPrintable: this.unregPrintable.bind(this),\n      },\n    };\n  }\n\n  regPrintable(key, node, isSingle) {\n    const loose = this.props.loose || this.props.invert;\n    debug('reg printable', key, node);\n\n    this.setState({\n      hasSingle: this.state.hasSingle || isSingle\n    });\n\n    if (this.printableRegistry[key] !== undefined || loose || isSingle) return;\n    setTimeout(() => this.setState({\n      printableNodes: this.state.printableNodes.concat(node),\n    }), 0);\n    this.printableRegistry[key] = this.state.printableNodes.length;\n  }\n\n  unregPrintable(key) {\n    const loose = this.props.loose || this.props.invert;\n    if (this.printableRegistry[key] === undefined || this.state.isInPrintPreview || loose) return;\n    this.setState({\n      printableNodes: spliced(this.state.printableNodes, this.printableRegistry[key]),\n    });\n    this.printableRegistry = Object.assign({}, this.printableRegistry, { [key]: undefined });\n  }\n\n  createRender(children) {\n    const el = document.createElement('div');\n    el.id = 'render';\n    document.body.appendChild(el);\n\n    ReactDOM.render(<div className={s.printRender} >{children}</div>, el);\n  }\n\n  deleteRender() {\n    const el = document.getElementById('render');\n    el && document.body.removeChild(el);\n  }\n\n  render() {\n    const { isInPrintPreview, printableNodes, hasSingle } = this.state;\n    const loose = this.props.loose || this.props.invert;\n\n    if (isInPrintPreview && printableNodes.length && !loose && !hasSingle) {\n      debug('render printable only', printableNodes);\n      const children = React.Children.map(printableNodes, (child,key) => {\n        return React.cloneElement(child, { key });\n      });\n\n      this.createRender(<div>{children}</div>);\n    }\n    setTimeout(() => this.deleteRender(), 0);\n\n    debug('render everything', isInPrintPreview, printableNodes.length, !loose);\n    const loose_ = loose ? s.loose : '';\n    const invert_ = this.props.invert ? s.invert : '';\n    const hiddenAll_ = hasSingle ? s.hiddenAll : '';\n\n    return <div className={`${s.wrap} ${loose_} ${invert_} ${hiddenAll_} `}>{this.props.children}</div>;\n  }\n}\nPrintProvider.propTypes = propTypes;\nPrintProvider.childContextTypes = childContextTypes;\n"]}