{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import React from \"react\";\nimport { findDOMNode } from \"react-dom\";\nimport PropTypes from \"prop-types\";\n\nclass ReactToPrint extends React.Component {\n\n  static propTypes = {\n    /** Copy styles over into print window. default: true */\n    copyStyles: PropTypes.bool, \n    /** Trigger action used to open browser print */\n    trigger: PropTypes.func.isRequired,\n    /** Content to be printed */\n    content: PropTypes.func.isRequired,\n    /** Callback function to trigger before print */\n    onBeforePrint: PropTypes.func,\n    /** Callback function to trigger after print */\n    onAfterPrint: PropTypes.func,\n    /** Close the print window after action */\n    closeAfterPrint: PropTypes.bool,\n    /** Optional class to pass to the print window body */\n    bodyClass: PropTypes.string,\n    /** Debug Mode */\n    debug: PropTypes.bool\n  };\n\n  static defaultProps = {\n    copyStyles: true,\n    closeAfterPrint: true,\n    bodyClass: '',\n    debug: false\n  };\n\n  triggerPrint(target) {\n    if (this.props.onBeforePrint) {\n      this.props.onBeforePrint();\n    }\n    setTimeout(() => {\n      if (!this.props.debug) {\n        target.print();\n        if (this.props.closeAfterPrint) {\n          target.close();\n        }\n      }\n    }, 500);\n  }\n\n  handlePrint = () => {\n  \n    const {\n      content,\n      copyStyles,\n      onAfterPrint\n    } = this.props;\n\n    let printWindow = window.open(\"\", \"Print\", \"status=no, toolbar=no, scrollbars=yes\", \"false\");\n    \n    if (onAfterPrint) {\n      printWindow.onbeforeunload = onAfterPrint;\n    }\n\n    const contentEl = content();\n    const contentNodes = findDOMNode(contentEl);\n\n    const imageNodes = [...contentNodes.getElementsByTagName(\"img\")];\n    const linkNodes = document.querySelectorAll('link[rel=\"stylesheet\"]');\n\n    this.imageTotal = imageNodes.length;\n    this.imageLoaded = 0;\n\n    this.linkTotal = linkNodes.length;\n    this.linkLoaded = 0;\n\n    const markLoaded = (type) => {\n\n      if (type === 'image')\n        this.imageLoaded++;\n      else if (type === 'link')\n        this.linkLoaded++;\n\n      if (this.imageLoaded === this.imageTotal && this.linkLoaded === this.linkTotal) {\n        this.triggerPrint(printWindow);\n      }\n\n    };\n\n    [...imageNodes].forEach((child) => {\n      /** Workaround for Safari if the image has base64 data as a source */\n      if (/^data:/.test(child.src)) {\n        child.crossOrigin = 'anonymous';\n      }\n      child.setAttribute('src', child.src);\n      child.onload = markLoaded.bind(null, 'image');\n      child.onerror = markLoaded.bind(null, 'image');\n      child.crossOrigin = 'use-credentials';\n    });\n\n    /*\n     * IE does not seem to allow appendChild from different window contexts correctly.  They seem to come back\n     * as plain objects. In order to get around this each tag is re-created into the printWindow\n     * https://stackoverflow.com/questions/38708840/calling-adoptnode-and-importnode-on-a-child-window-fails-in-ie-and-edge\n     */\n    if (copyStyles !== false) {\n\n      const headEls = document.querySelectorAll('style, link[rel=\"stylesheet\"]');\n      [...headEls].forEach(node => { \n      \n        const doc = printWindow.contentDocument || printWindow.document;\n        let newHeadEl = doc.createElement(node.tagName);\n\n        if (node.textContent)\n          newHeadEl.textContent = node.textContent;\n        else if (node.innerText)\n          newHeadEl.innerText = node.innerText;\n  \n        let attributes = [...node.attributes];\n        attributes.forEach(attr => {\n\n          let nodeValue = attr.nodeValue;\n\n          if (\n            attr.nodeName === 'href' && \n            /^https?:\\/\\//.test(attr.nodeValue) === false && \n            /^blob:/.test(attr.nodeValue) === false\n          ) {\n            \n            const relPath = attr.nodeValue.substr(0, 3) === \"../\" \n              ? document.location.pathname.replace(/[^/]*$/, '') \n              : \"/\";\n\n            nodeValue = nodeValue.replace(/\\/+/, '');\n            nodeValue = document.location.protocol + '//' + document.location.host + relPath + nodeValue;\n            \n          }\n\n          newHeadEl.setAttribute(attr.nodeName, nodeValue);\n        });\n\n        if (node.tagName === 'LINK') {\n          newHeadEl.onload = markLoaded.bind(null, 'link');\n          newHeadEl.onerror = markLoaded.bind(null, 'link');          \n        }\n\n        printWindow.document.head.appendChild(newHeadEl);\n\n      });\n\n    }\n\n    if (document.body.className) {\n      const bodyClasses = document.body.className.split(\" \");\n      bodyClasses\n          .filter(item => item)\n          .map(item => printWindow.document.body.classList.add(item));\n    }\n    \n    if (this.props.bodyClass.length) {\n      printWindow.document.body.classList.add(this.props.bodyClass);\n    }\n\n    /* remove date/time from top */\n    let styleEl = printWindow.document.createElement('style');\n    styleEl.appendChild(printWindow.document.createTextNode(\"@page { size: auto;  margin: 0mm; } @media print { body { -webkit-print-color-adjust: exact; } }\"));\n\n    printWindow.document.head.appendChild(styleEl);\n    printWindow.document.body.innerHTML = contentNodes.outerHTML;\n\n    if (this.imageTotal === 0 || copyStyles === false) {\n      this.triggerPrint(printWindow);\n    }\n\n    if (this.props.debug) {\n      console.log(\"** DEBUG MODE **\");\n      console.log(printWindow.document);\n    }\n\n  }\n\n  render() {\n\n    return React.cloneElement(this.props.trigger(), {\n     ref: (el) => this.triggerRef = el,\n     onClick: this.handlePrint\n    });\n\n  }\n\n}\n\nexport default ReactToPrint;\n"],"names":["ReactToPrint","handlePrint","_this","props","content","copyStyles","onAfterPrint","printWindow","window","open","onbeforeunload","contentEl","contentNodes","findDOMNode","imageNodes","getElementsByTagName","linkNodes","document","querySelectorAll","imageTotal","length","imageLoaded","linkTotal","linkLoaded","markLoaded","type","triggerPrint","forEach","child","test","src","crossOrigin","setAttribute","onload","bind","onerror","headEls","newHeadEl","contentDocument","createElement","node","tagName","textContent","innerText","attributes","nodeValue","attr","nodeName","relPath","substr","location","pathname","replace","protocol","host","head","appendChild","body","className","split","filter","item","map","classList","add","bodyClass","styleEl","createTextNode","innerHTML","outerHTML","debug","log","target","this","onBeforePrint","_this2","print","closeAfterPrint","close","React","cloneElement","trigger","el","_this3","triggerRef","Component","defaultProps"],"mappings":"+sCAIMA,mQA0CJC,YAAc,iBAMRC,EAAKC,MAHPC,IAAAA,QACAC,IAAAA,WACAC,IAAAA,aAGEC,EAAcC,OAAOC,KAAK,GAAI,QAAS,wCAAyC,SAEhFH,MACUI,eAAiBJ,OAGzBK,EAAYP,IACZQ,EAAeC,qBAAYF,GAE3BG,8BAAiBF,EAAaG,qBAAqB,SACnDC,EAAYC,SAASC,iBAAiB,4BAEvCC,WAAaL,EAAWM,SACxBC,YAAc,IAEdC,UAAYN,EAAUI,SACtBG,WAAa,MAEZC,EAAa,SAACC,GAEL,UAATA,EACFvB,EAAKmB,cACW,SAATI,GACPvB,EAAKqB,aAEHrB,EAAKmB,cAAgBnB,EAAKiB,YAAcjB,EAAKqB,aAAerB,EAAKoB,aAC9DI,aAAanB,mCAKlBO,IAAYa,QAAQ,SAACC,GAEnB,SAASC,KAAKD,EAAME,SAChBC,YAAc,eAEhBC,aAAa,MAAOJ,EAAME,OAC1BG,OAAST,EAAWU,KAAK,KAAM,WAC/BC,QAAUX,EAAWU,KAAK,KAAM,WAChCH,YAAc,qBAQH,IAAf1B,EAAsB,KAElB+B,EAAUnB,SAASC,iBAAiB,6DACtCkB,IAAST,QAAQ,gBAGfU,GADQ9B,EAAY+B,iBAAmB/B,EAAYU,UACnCsB,cAAcC,EAAKC,SAEnCD,EAAKE,YACPL,EAAUK,YAAcF,EAAKE,YACtBF,EAAKG,YACZN,EAAUM,UAAYH,EAAKG,uCAERH,EAAKI,aACfjB,QAAQ,gBAEbkB,EAAYC,EAAKD,aAGD,SAAlBC,EAAKC,WACmC,IAAxC,eAAelB,KAAKiB,EAAKD,aACS,IAAlC,SAAShB,KAAKiB,EAAKD,WACnB,KAEMG,EAA0C,QAAhCF,EAAKD,UAAUI,OAAO,EAAG,GACrChC,SAASiC,SAASC,SAASC,QAAQ,SAAU,IAC7C,MAEQP,EAAUO,QAAQ,MAAO,MACzBnC,SAASiC,SAASG,SAAW,KAAOpC,SAASiC,SAASI,KAAON,EAAUH,IAI3Eb,aAAac,EAAKC,SAAUF,KAGnB,SAAjBL,EAAKC,YACGR,OAAST,EAAWU,KAAK,KAAM,UAC/BC,QAAUX,EAAWU,KAAK,KAAM,WAGhCjB,SAASsC,KAAKC,YAAYnB,QAMtCpB,SAASwC,KAAKC,UAAW,CACPzC,SAASwC,KAAKC,UAAUC,MAAM,KAE7CC,OAAO,mBAAQC,IACfC,IAAI,mBAAQvD,EAAYU,SAASwC,KAAKM,UAAUC,IAAIH,KAGvD3D,EAAKC,MAAM8D,UAAU7C,UACXH,SAASwC,KAAKM,UAAUC,IAAI9D,EAAKC,MAAM8D,eAIjDC,EAAU3D,EAAYU,SAASsB,cAAc,WACzCiB,YAAYjD,EAAYU,SAASkD,eAAe,uGAE5ClD,SAASsC,KAAKC,YAAYU,KAC1BjD,SAASwC,KAAKW,UAAYxD,EAAayD,UAE3B,IAApBnE,EAAKiB,aAAmC,IAAfd,KACtBqB,aAAanB,GAGhBL,EAAKC,MAAMmE,gBACLC,IAAI,4BACJA,IAAIhE,EAAYU,sHA5IfuD,cACPC,KAAKtE,MAAMuE,oBACRvE,MAAMuE,2BAEF,WACJC,EAAKxE,MAAMmE,UACPM,QACHD,EAAKxE,MAAM0E,mBACNC,UAGV,wDAwIIC,MAAMC,aAAaP,KAAKtE,MAAM8E,eAC/B,SAACC,UAAOC,EAAKC,WAAaF,WACtBT,KAAKxE,qBAjLQ8E,MAAMM,WAA3BrF,aAqBGsF,0BACO,mBACK,YACN,UACJ"}